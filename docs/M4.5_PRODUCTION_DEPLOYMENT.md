# M4.5 â€“ Production Deployment

**Owner:** Jordan / Quinn. **Status:** Documented; deployment checks in place.

---

## 1. Pre-deployment checks

- **Tests:** Run `./scripts/deployment-check.sh` from repo root (or `tools/testing/tgnd-test-run.sh`). Requires `DATABASE_URL` for full API tests.
- **Health:** Before/after deploy, verify `GET /health` and `GET /ready` (see M4.4). Use `./scripts/deployment-check.sh --api-url http://your-api:3000` to validate a running instance.

---

## 2. Production deployment steps

1. **Server:** Use Lunaverse (or target server); TGND can live under `/mnt/lacie_external/tgnd` (see `scripts/server-env-setup.sh`).
2. **Env:** Copy `.env.example` to `.env` on server; set `DATABASE_URL`, `TGND_API_KEY` (recommended), `PORT`, `CORS_ORIGIN`, and any provider/field platform keys. Never commit `.env`.
3. **DB:** Run migrations: `cd apps/api && npm run migrate` (or `node scripts/run-migration.js` from repo root with `.env` loaded).
4. **API:** Start API: `cd apps/api && npm start` (or use process manager: pm2, systemd). Listen on `PORT` (default 3000).
5. **Portal:** Build/serve `apps/portal` (e.g. SvelteKit build + serve) or static export; point `CORS_ORIGIN` at portal origin.
6. **Backup:** Schedule `scripts/backup-db.sh` (cron); retain and store off-host.
7. **Monitoring:** Point health checks at `/health` and `/ready`; collect logs (stdout JSON) for error rate and alerts.

---

## 3. Quinn: tests and verification

- Ensure all tests in `apps/api` and other packages pass (`npm run test` per package; `tgnd-test-run.sh` for full suite).
- Add or extend tests for new routes/features as needed. Deployment check script runs the existing suite; fix any failures before marking M4.5 Done.

---

*When all tests and deployment checks pass and production deployment is documented and (optionally) executed, mark M4.5 Done in CHECKLIST.*
